<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mantenimiento - SimCardio</title>
    <meta name="description" content="Editor de casos clÃ­nicos y configuraciÃ³n del simulador SimCardio">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,300;0,400;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* â”€â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --bg-base:      #080c14;
            --bg-surface:   #0e1421;
            --bg-elevated:  #141c2e;
            --bg-hover:     #1a2438;
            --bg-active:    #1e2b42;
            --accent:       #3b82f6;
            --accent-glow:  rgba(59,130,246,0.25);
            --accent-dim:   rgba(59,130,246,0.12);
            --green:        #22c55e;
            --green-dim:    rgba(34,197,94,0.12);
            --red:          #ef4444;
            --red-dim:      rgba(239,68,68,0.12);
            --amber:        #f59e0b;
            --amber-dim:    rgba(245,158,11,0.12);
            --cyan:         #06b6d4;
            --violet:       #8b5cf6;
            --text-primary: #e2e8f0;
            --text-secondary:#94a3b8;
            --text-muted:   #475569;
            --border:       rgba(255,255,255,0.07);
            --border-focus: rgba(59,130,246,0.5);
            --radius-sm:    6px;
            --radius-md:    10px;
            --radius-lg:    14px;
            --shadow-sm:    0 1px 3px rgba(0,0,0,0.4);
            --shadow-md:    0 4px 16px rgba(0,0,0,0.5);
            --shadow-lg:    0 8px 32px rgba(0,0,0,0.6);
            --font-mono:    'JetBrains Mono', monospace;
        }

        html, body { height: 100%; }

        body {
            font-family: 'Titillium Web', sans-serif;
            background: var(--bg-base);
            color: var(--text-primary);
            overflow: hidden;
            font-size: 15px;
        }

        /* â”€â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .app {
            display: grid;
            grid-template-rows: 56px 1fr;
            height: 100vh;
        }

        /* â”€â”€â”€ Top Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            background: var(--bg-surface);
            border-bottom: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
            z-index: 100;
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .back-link {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            padding: 6px 10px;
            border-radius: var(--radius-sm);
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        .back-link:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
            border-color: var(--border);
        }
        .back-link svg { width: 14px; height: 14px; }

        .topbar-brand {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .topbar-brand .logo-dot {
            width: 8px; height: 8px;
            background: var(--green);
            border-radius: 50%;
            box-shadow: 0 0 8px var(--green);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        .topbar-brand h1 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: 0.5px;
        }
        .topbar-brand .tag {
            font-size: 0.7rem;
            padding: 2px 8px;
            background: var(--accent-dim);
            color: var(--accent);
            border: 1px solid rgba(59,130,246,0.3);
            border-radius: 100px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .topbar-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* â”€â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 7px 16px;
            border: 1px solid transparent;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .btn svg { width: 14px; height: 14px; flex-shrink: 0; }

        .btn-primary {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
        }
        .btn-primary:hover {
            background: #2563eb;
            box-shadow: 0 0 16px var(--accent-glow);
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--green-dim);
            color: var(--green);
            border-color: rgba(34,197,94,0.3);
        }
        .btn-success:hover {
            background: rgba(34,197,94,0.2);
            box-shadow: 0 0 16px rgba(34,197,94,0.2);
            transform: translateY(-1px);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
            border-color: var(--border);
        }
        .btn-ghost:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .btn-danger {
            background: var(--red-dim);
            color: var(--red);
            border-color: rgba(239,68,68,0.3);
        }
        .btn-danger:hover {
            background: rgba(239,68,68,0.2);
        }

        .btn-sm { padding: 5px 10px; font-size: 0.8rem; }
        .btn-icon { padding: 6px; border-radius: var(--radius-sm); }
        .btn-icon svg { width: 15px; height: 15px; }

        /* â”€â”€â”€ Main Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .main-grid {
            display: grid;
            grid-template-columns: 280px 1fr;
            overflow: hidden;
        }

        /* â”€â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .sidebar {
            background: var(--bg-surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 14px 16px 10px;
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sidebar-title {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-muted);
        }

        .sidebar-search {
            position: relative;
        }
        .sidebar-search svg {
            position: absolute;
            left: 9px;
            top: 50%;
            transform: translateY(-50%);
            width: 13px; height: 13px;
            color: var(--text-muted);
        }
        .sidebar-search input {
            width: 100%;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.82rem;
            padding: 6px 10px 6px 28px;
            outline: none;
            transition: border-color 0.2s;
        }
        .sidebar-search input:focus { border-color: var(--border-focus); }
        .sidebar-search input::placeholder { color: var(--text-muted); }

        .case-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }
        .case-list::-webkit-scrollbar { width: 4px; }
        .case-list::-webkit-scrollbar-track { background: transparent; }
        .case-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

        .case-item {
            padding: 10px 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.18s;
            margin-bottom: 4px;
            border: 1px solid transparent;
            position: relative;
        }
        .case-item:hover { background: var(--bg-hover); border-color: var(--border); }
        .case-item.active {
            background: var(--accent-dim);
            border-color: rgba(59,130,246,0.35);
        }
        .case-item.active::before {
            content: '';
            position: absolute;
            left: 0; top: 20%; bottom: 20%;
            width: 3px;
            background: var(--accent);
            border-radius: 0 2px 2px 0;
        }

        .case-item-number {
            font-size: 0.68rem;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 3px;
            font-family: var(--font-mono);
        }
        .case-item.active .case-item-number { color: var(--accent); }

        .case-item-name {
            font-size: 0.83rem;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .case-item-meta {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 6px;
        }
        .stage-badge {
            font-size: 0.7rem;
            padding: 1px 6px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 100px;
            color: var(--text-muted);
            font-family: var(--font-mono);
        }
        .case-item.active .stage-badge {
            background: var(--accent-dim);
            border-color: rgba(59,130,246,0.3);
            color: var(--accent);
        }

        .sidebar-footer {
            padding: 12px;
            border-top: 1px solid var(--border);
        }

        /* â”€â”€â”€ Editor Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .editor-panel {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-base);
        }

        .empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
            color: var(--text-muted);
        }
        .empty-state svg { width: 48px; height: 48px; opacity: 0.3; }
        .empty-state h3 { font-size: 1rem; color: var(--text-secondary); }
        .empty-state p { font-size: 0.85rem; }

        .editor-content {
            display: none;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }
        .editor-content.active { display: flex; }

        /* Editor Header */
        .editor-header {
            padding: 16px 24px;
            background: var(--bg-surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 16px;
            flex-shrink: 0;
        }

        .editor-header-left { flex: 1; }

        .editor-label {
            font-size: 0.68rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-muted);
            margin-bottom: 6px;
            font-family: var(--font-mono);
        }

        .paciente-input {
            width: 100%;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
            padding: 10px 14px;
            resize: none;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
            line-height: 1.5;
        }
        .paciente-input:focus {
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px var(--accent-dim);
        }
        .paciente-input::placeholder { color: var(--text-muted); }

        /* â”€â”€â”€ Stages Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .stages-section {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .stages-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .stages-toolbar-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stages-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stages-count {
            font-size: 0.75rem;
            padding: 2px 8px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 100px;
            color: var(--text-muted);
            font-family: var(--font-mono);
        }

        /* â”€â”€â”€ Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .table-wrapper {
            flex: 1;
            overflow: auto;
            padding: 0 24px 24px;
        }
        .table-wrapper::-webkit-scrollbar { width: 6px; height: 6px; }
        .table-wrapper::-webkit-scrollbar-track { background: transparent; }
        .table-wrapper::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

        .stages-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 16px;
            font-size: 0.82rem;
        }

        .stages-table thead th {
            padding: 9px 10px;
            text-align: left;
            font-size: 0.68rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            background: var(--bg-surface);
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .stages-table thead th:first-child {
            border-left: 1px solid var(--border);
            border-radius: var(--radius-sm) 0 0 0;
            padding-left: 14px;
        }
        .stages-table thead th:last-child {
            border-right: 1px solid var(--border);
            border-radius: 0 var(--radius-sm) 0 0;
        }

        .stages-table tbody tr {
            transition: background 0.15s;
        }
        .stages-table tbody tr:hover { background: var(--bg-hover); }

        .stages-table tbody td {
            padding: 8px 10px;
            border-bottom: 1px solid var(--border);
            vertical-align: top;
        }
        .stages-table tbody td:first-child {
            border-left: 1px solid var(--border);
            padding-left: 14px;
        }
        .stages-table tbody td:last-child {
            border-right: 1px solid var(--border);
        }
        .stages-table tbody tr:last-child td:first-child {
            border-radius: 0 0 0 var(--radius-sm);
        }
        .stages-table tbody tr:last-child td:last-child {
            border-radius: 0 0 var(--radius-sm) 0;
        }

        /* Stage Number Cell */
        .stage-num {
            font-family: var(--font-mono);
            font-size: 0.72rem;
            font-weight: 500;
            color: var(--text-muted);
            text-align: center;
            min-width: 30px;
        }

        /* Table inputs */
        .t-input {
            width: 100%;
            background: transparent;
            border: 1px solid transparent;
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: var(--font-mono);
            font-size: 0.82rem;
            padding: 4px 6px;
            outline: none;
            transition: all 0.15s;
            resize: vertical;
        }
        .t-input:hover { border-color: var(--border); background: var(--bg-elevated); }
        .t-input:focus {
            background: var(--bg-elevated);
            border-color: var(--border-focus);
            box-shadow: 0 0 0 2px var(--accent-dim);
        }

        .t-textarea {
            width: 100%;
            background: transparent;
            border: 1px solid transparent;
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: 'Titillium Web', sans-serif;
            font-size: 0.82rem;
            padding: 4px 6px;
            outline: none;
            transition: all 0.15s;
            resize: vertical;
            min-height: 52px;
            line-height: 1.4;
        }
        .t-textarea:hover { border-color: var(--border); background: var(--bg-elevated); }
        .t-textarea:focus {
            background: var(--bg-elevated);
            border-color: var(--border-focus);
            box-shadow: 0 0 0 2px var(--accent-dim);
        }

        /* Vital value cells */
        .vital-cell { min-width: 60px; }

        /* Vitals special coloring */
        .t-input.vital-hr:focus { border-color: rgba(239,68,68,0.5); box-shadow: 0 0 0 2px rgba(239,68,68,0.1); }
        .t-input.vital-bp:focus { border-color: rgba(245,158,11,0.5); box-shadow: 0 0 0 2px rgba(245,158,11,0.1); }
        .t-input.vital-spo2:focus { border-color: rgba(6,182,212,0.5); box-shadow: 0 0 0 2px rgba(6,182,212,0.1); }
        .t-input.vital-capno:focus { border-color: rgba(139,92,246,0.5); box-shadow: 0 0 0 2px rgba(139,92,246,0.1); }
        .t-input.vital-glu:focus { border-color: rgba(34,197,94,0.5); box-shadow: 0 0 0 2px rgba(34,197,94,0.1); }

        /* Rhythm Select */
        .rhythm-select {
            width: 100%;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.78rem;
            padding: 5px 6px;
            outline: none;
            cursor: pointer;
            transition: border-color 0.15s;
            min-width: 160px;
        }
        .rhythm-select:focus { border-color: var(--border-focus); }
        .rhythm-select option { background: var(--bg-elevated); }

        /* Rhythm Chip */
        .rhythm-chip {
            display: inline-block;
            margin-top: 4px;
            padding: 2px 7px;
            border-radius: 100px;
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        .chip-normal { background: var(--green-dim); color: var(--green); border: 1px solid rgba(34,197,94,0.3); }
        .chip-critical { background: var(--red-dim); color: var(--red); border: 1px solid rgba(239,68,68,0.3); }
        .chip-warning { background: var(--amber-dim); color: var(--amber); border: 1px solid rgba(245,158,11,0.3); }
        .chip-info { background: rgba(6,182,212,0.12); color: var(--cyan); border: 1px solid rgba(6,182,212,0.3); }

        /* EKG Cell */
        .ekg-cell { min-width: 130px; }
        .ekg-cell-inner { display: flex; flex-direction: column; gap: 5px; }
        .ekg-link {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.75rem;
            color: var(--accent);
            text-decoration: none;
            padding: 3px 7px;
            background: var(--accent-dim);
            border: 1px solid rgba(59,130,246,0.25);
            border-radius: var(--radius-sm);
            transition: all 0.2s;
        }
        .ekg-link:hover { background: rgba(59,130,246,0.2); }
        .ekg-link svg { width: 11px; height: 11px; }

        .file-input-wrapper {
            position: relative;
        }
        .file-input-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.72rem;
            color: var(--text-muted);
            padding: 3px 7px;
            background: var(--bg-elevated);
            border: 1px dashed var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            justify-content: center;
        }
        .file-input-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        .file-input-btn svg { width: 11px; height: 11px; }
        .file-input-wrapper input[type="file"] {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
        }

        /* Delete Row Button */
        .delete-row-btn {
            background: none;
            border: 1px solid transparent;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .delete-row-btn:hover {
            background: var(--red-dim);
            border-color: rgba(239,68,68,0.3);
            color: var(--red);
        }
        .delete-row-btn svg { width: 14px; height: 14px; }

        /* â”€â”€â”€ Toast Notification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 9999;
        }

        .toast {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 18px;
            border-radius: var(--radius-md);
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease;
            min-width: 220px;
            border: 1px solid;
        }
        .toast svg { width: 16px; height: 16px; flex-shrink: 0; }
        .toast-success {
            background: #0f2d1a;
            color: var(--green);
            border-color: rgba(34,197,94,0.3);
        }
        .toast-error {
            background: #2d0f0f;
            color: var(--red);
            border-color: rgba(239,68,68,0.3);
        }
        .toast-info {
            background: #0f1a2d;
            color: var(--accent);
            border-color: rgba(59,130,246,0.3);
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; transform: translateY(10px); }
        }

        /* â”€â”€â”€ Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex: 1;
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        .loader-dots {
            display: flex; gap: 6px;
        }
        .loader-dots span {
            width: 7px; height: 7px;
            background: var(--accent);
            border-radius: 50%;
            animation: dotPulse 1.2s infinite ease-in-out;
        }
        .loader-dots span:nth-child(2) { animation-delay: 0.2s; }
        .loader-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes dotPulse {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* â”€â”€â”€ Confirm Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }
        .modal-overlay.open { display: flex; }
        .modal {
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 28px;
            max-width: 380px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            animation: modalIn 0.25s ease;
        }
        @keyframes modalIn {
            from { transform: scale(0.92); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .modal-icon {
            width: 44px; height: 44px;
            background: var(--red-dim);
            border: 1px solid rgba(239,68,68,0.3);
            border-radius: var(--radius-md);
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 16px;
            color: var(--red);
        }
        .modal-icon svg { width: 22px; height: 22px; }
        .modal h3 { font-size: 1rem; margin-bottom: 8px; }
        .modal p { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5; }
        .modal-actions {
            display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end;
        }
    </style>
</head>

<body>
<div class="app">

    <!-- â”€â”€ Top Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <header class="topbar">
        <div class="topbar-left">
            <a href="index.html" class="back-link">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                MenÃº
            </a>
            <div class="topbar-brand">
                <div class="logo-dot"></div>
                <h1>SimCardio</h1>
                <span class="tag">MANTENIMIENTO</span>
            </div>
        </div>
        <div class="topbar-actions">
            <button class="btn btn-success" onclick="saveAll()" id="save-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                Guardar Cambios
            </button>
        </div>
    </header>

    <!-- â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="main-grid">

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <span class="sidebar-title">Casos ClÃ­nicos</span>
                <div class="sidebar-search">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                    <input type="text" id="search-input" placeholder="Buscar caso..." oninput="filterCases(this.value)">
                </div>
            </div>

            <div class="case-list" id="case-list">
                <div class="loader">
                    <div class="loader-dots"><span></span><span></span><span></span></div>
                    Cargando casos...
                </div>
            </div>

            <div class="sidebar-footer">
                <button class="btn btn-primary" style="width:100%;" onclick="addNewCase()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    Nuevo Caso
                </button>
            </div>
        </aside>

        <!-- Editor Panel -->
        <main class="editor-panel">

            <!-- Empty State -->
            <div class="empty-state" id="empty-state">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5.586a1 1 0 0 1 .707.293l5.414 5.414a1 1 0 0 1 .293.707V19a2 2 0 0 1-2 2z"/>
                </svg>
                <h3>Selecciona un caso</h3>
                <p>Elige un caso de la lista o crea uno nuevo</p>
            </div>

            <!-- Editor -->
            <div class="editor-content" id="editor-content">

                <!-- Editor Header: Patient Info -->
                <div class="editor-header">
                    <div class="editor-header-left">
                        <div class="editor-label" id="case-label">CASO #1 â€” DescripciÃ³n del Paciente</div>
                        <textarea
                            class="paciente-input"
                            id="edit-paciente"
                            rows="2"
                            placeholder="DescripciÃ³n clÃ­nica del paciente..."
                        ></textarea>
                    </div>
                    <div style="display:flex; gap:8px; padding-top:22px; flex-shrink:0;">
                        <button class="btn btn-danger btn-sm" onclick="confirmDelete()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>
                            Eliminar Caso
                        </button>
                    </div>
                </div>

                <!-- Stages -->
                <div class="stages-section">
                    <div class="stages-toolbar">
                        <div class="stages-toolbar-left">
                            <span class="stages-title">Etapas</span>
                            <span class="stages-count" id="stages-count">0</span>
                        </div>
                        <button class="btn btn-ghost btn-sm" onclick="addStage()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            Agregar Etapa
                        </button>
                    </div>

                    <div class="table-wrapper">
                        <table class="stages-table" id="stages-table">
                            <thead>
                                <tr>
                                    <th style="width:28px; text-align:center;">#</th>
                                    <th style="min-width:200px;">DescripciÃ³n / Info Adicional</th>
                                    <th style="width:72px;">â¤ï¸ HR</th>
                                    <th style="width:90px;">ğŸ©¸ BP</th>
                                    <th style="width:72px;">ğŸ’§ SpOâ‚‚</th>
                                    <th style="width:72px;">ğŸ« EtCOâ‚‚</th>
                                    <th style="width:72px;">ğŸ¬ Glu</th>
                                    <th style="min-width:180px;">âš¡ Ritmo</th>
                                    <th style="width:140px;">ğŸ–¼ EKG 12D</th>
                                    <th style="width:36px;"></th>
                                </tr>
                            </thead>
                            <tbody id="stages-tbody"></tbody>
                        </table>
                    </div>
                </div>

            </div>
        </main>
    </div>
</div>

<!-- â”€â”€ Toast Container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="toast-container"></div>

<!-- â”€â”€ Confirm Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-overlay" id="confirm-modal">
    <div class="modal">
        <div class="modal-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/>
                <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/>
            </svg>
        </div>
        <h3>Eliminar caso clÃ­nico</h3>
        <p>Esta acciÃ³n es irreversible. Â¿Deseas eliminar el caso seleccionado y todas sus etapas?</p>
        <div class="modal-actions">
            <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
            <button class="btn btn-danger" onclick="deleteCurrentCase()">SÃ­, eliminar</button>
        </div>
    </div>
</div>

<script>
    // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let cases = [];
    let currentCaseIndex = -1;
    let filteredIndices = [];

    const RHYTHM_OPTIONS = [
        { value: "RITMO_SINUSAL",              label: "Ritmo Sinusal",              chip: "chip-normal"   },
        { value: "BRADICARDIA_SINUSAL",         label: "Bradicardia Sinusal",        chip: "chip-warning"  },
        { value: "TAQUICARDIA_SUPRAVENTRICULAR",label: "Taquicardia SVT",            chip: "chip-warning"  },
        { value: "FIBRILACION_AURICULAR",       label: "FibrilaciÃ³n Auricular",      chip: "chip-warning"  },
        { value: "BLOQUEO_AV_GRADO_1",         label: "Bloqueo AV Grado 1",         chip: "chip-info"     },
        { value: "BLOQUEO_AV_2_MOBITZ_1",      label: "Bloqueo AV Mobitz I",        chip: "chip-warning"  },
        { value: "TAQUICARDIA_VENTRICULAR",    label: "Taquicardia Ventricular",    chip: "chip-critical" },
        { value: "FIBRILACION_VENTRICULAR",    label: "FibrilaciÃ³n Ventricular",    chip: "chip-critical" },
        { value: "ASISTOLIA",                  label: "Asistolia",                  chip: "chip-critical" },
        { value: "INFARTO_AGUDO_MIOCARDIO",    label: "Infarto Agudo (IAM)",        chip: "chip-critical" },
    ];

    function getRhythmInfo(value) {
        return RHYTHM_OPTIONS.find(r => r.value === value) || { label: value, chip: "chip-info" };
    }

    // â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showToast(message, type = 'success') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;

        const icons = {
            success: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>',
            error:   '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>',
            info:    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>'
        };

        toast.innerHTML = `${icons[type]} <span>${message}</span>`;
        container.appendChild(toast);

        setTimeout(() => {
            toast.style.animation = 'fadeOut 0.3s ease forwards';
            setTimeout(() => toast.remove(), 300);
        }, 2800);
    }

    // â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function confirmDelete() {
        document.getElementById('confirm-modal').classList.add('open');
    }
    function closeModal() {
        document.getElementById('confirm-modal').classList.remove('open');
    }

    // â”€â”€ Load & Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadCases() {
        try {
            const res = await fetch('/api/casos');
            cases = await res.json();
            filteredIndices = cases.map((_, i) => i);
            renderCaseList();
        } catch (e) {
            showToast('Error al cargar los casos', 'error');
        }
    }

    function filterCases(query) {
        const q = query.toLowerCase().trim();
        filteredIndices = cases.map((_, i) => i).filter(i =>
            !q || cases[i].paciente.toLowerCase().includes(q)
        );
        renderCaseList();
    }

    function renderCaseList() {
        const container = document.getElementById('case-list');
        container.innerHTML = '';

        if (filteredIndices.length === 0) {
            container.innerHTML = `<div style="padding:20px; text-align:center; color:var(--text-muted); font-size:0.83rem;">Sin resultados</div>`;
            return;
        }

        filteredIndices.forEach(index => {
            const c = cases[index];
            const div = document.createElement('div');
            div.className = `case-item ${index === currentCaseIndex ? 'active' : ''}`;
            div.dataset.index = index;

            const stagesCount = c.etapas ? c.etapas.length : 0;
            const preview = c.paciente.length > 70 ? c.paciente.substring(0, 70) + 'â€¦' : c.paciente;

            div.innerHTML = `
                <div class="case-item-number">Caso ${index + 1}</div>
                <div class="case-item-name">${preview}</div>
                <div class="case-item-meta">
                    <span class="stage-badge">${stagesCount} etapa${stagesCount !== 1 ? 's' : ''}</span>
                </div>
            `;
            div.onclick = () => selectCase(index);
            container.appendChild(div);
        });
    }

    function selectCase(index) {
        currentCaseIndex = index;
        renderCaseList();

        const c = cases[index];
        document.getElementById('empty-state').style.display = 'none';
        document.getElementById('editor-content').classList.add('active');
        document.getElementById('case-label').textContent = `CASO #${index + 1} â€” DescripciÃ³n del Paciente`;
        document.getElementById('edit-paciente').value = c.paciente;
        renderStages(c.etapas || []);
    }

    // â”€â”€ Stages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderStages(etapas) {
        const tbody = document.getElementById('stages-tbody');
        tbody.innerHTML = '';
        document.getElementById('stages-count').textContent = etapas.length;

        etapas.forEach((etapa, idx) => {
            const rhythmInfo = getRhythmInfo(etapa.ritmo || '');

            // Rhythm select options
            let rhythmOpts = RHYTHM_OPTIONS.map(r =>
                `<option value="${r.value}" ${etapa.ritmo === r.value ? 'selected' : ''}>${r.label}</option>`
            ).join('');

            // EKG cell
            let ekgHtml = `<div class="ekg-cell-inner">`;
            if (etapa.ekg12d) {
                ekgHtml += `<a href="${etapa.ekg12d}" target="_blank" class="ekg-link">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                    Ver imagen
                </a>`;
            }
            ekgHtml += `<div class="file-input-wrapper">
                <label class="file-input-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                    ${etapa.ekg12d ? 'Cambiar' : 'Subir ECG'}
                </label>
                <input type="file" accept="image/*" onchange="uploadImage(this, ${idx})">
            </div></div>`;

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td class="stage-num">${idx + 1}</td>
                <td><textarea class="t-textarea" rows="2" onchange="updateStage(${idx}, 'infoAdicional', this.value)">${etapa.infoAdicional || ''}</textarea></td>
                <td class="vital-cell"><input class="t-input vital-hr" value="${etapa.hr || ''}" placeholder="â€”" onchange="updateStage(${idx}, 'hr', this.value)"></td>
                <td class="vital-cell"><input class="t-input vital-bp" value="${etapa.bp || ''}" placeholder="â€”" onchange="updateStage(${idx}, 'bp', this.value)"></td>
                <td class="vital-cell"><input class="t-input vital-spo2" value="${etapa.spo2 || ''}" placeholder="â€”" onchange="updateStage(${idx}, 'spo2', this.value)"></td>
                <td class="vital-cell"><input class="t-input vital-capno" value="${etapa.capno || ''}" placeholder="â€”" onchange="updateStage(${idx}, 'capno', this.value)"></td>
                <td class="vital-cell"><input class="t-input vital-glu" value="${etapa.glucose || ''}" placeholder="â€”" onchange="updateStage(${idx}, 'glucose', this.value)"></td>
                <td>
                    <select class="rhythm-select" onchange="updateStage(${idx}, 'ritmo', this.value); updateRhythmChip(this)">
                        <option value="">â€” Sin ritmo â€”</option>
                        ${rhythmOpts}
                    </select>
                    ${etapa.ritmo ? `<span class="rhythm-chip ${rhythmInfo.chip}">${rhythmInfo.label}</span>` : ''}
                </td>
                <td class="ekg-cell">${ekgHtml}</td>
                <td>
                    <button class="delete-row-btn" onclick="removeStage(${idx})" title="Eliminar etapa">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    function updateRhythmChip(select) {
        const td = select.parentElement;
        const existing = td.querySelector('.rhythm-chip');
        if (existing) existing.remove();

        if (select.value) {
            const info = getRhythmInfo(select.value);
            const chip = document.createElement('span');
            chip.className = `rhythm-chip ${info.chip}`;
            chip.textContent = info.label;
            td.appendChild(chip);
        }
    }

    // â”€â”€ Data Operations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('edit-paciente').addEventListener('input', (e) => {
        if (currentCaseIndex > -1) {
            cases[currentCaseIndex].paciente = e.target.value;
            renderCaseList();
        }
    });

    function updateStage(stageIdx, field, value) {
        if (currentCaseIndex > -1) {
            cases[currentCaseIndex].etapas[stageIdx][field] = value;
        }
    }

    function addStage() {
        if (currentCaseIndex === -1) return;
        cases[currentCaseIndex].etapas.push({
            infoAdicional: '', bp: '', spo2: '', capno: '', hr: '', glucose: '', ritmo: 'RITMO_SINUSAL'
        });
        renderStages(cases[currentCaseIndex].etapas);
        renderCaseList();
        // Scroll to bottom of table
        const wrapper = document.querySelector('.table-wrapper');
        wrapper.scrollTop = wrapper.scrollHeight;
    }

    function removeStage(stageIdx) {
        cases[currentCaseIndex].etapas.splice(stageIdx, 1);
        renderStages(cases[currentCaseIndex].etapas);
        renderCaseList();
    }

    function addNewCase() {
        const newCase = { paciente: 'Nuevo Caso ClÃ­nico', etapas: [] };
        cases.push(newCase);
        filteredIndices = cases.map((_, i) => i);
        document.getElementById('search-input').value = '';
        selectCase(cases.length - 1);
        renderCaseList();
        setTimeout(() => document.getElementById('edit-paciente').focus(), 50);
    }

    function deleteCurrentCase() {
        closeModal();
        cases.splice(currentCaseIndex, 1);
        filteredIndices = cases.map((_, i) => i);
        currentCaseIndex = -1;
        document.getElementById('empty-state').style.display = '';
        document.getElementById('editor-content').classList.remove('active');
        renderCaseList();
        showToast('Caso eliminado', 'info');
    }

    // â”€â”€ Upload â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function uploadImage(input, stageIdx) {
        if (input.files && input.files[0]) {
            const formData = new FormData();
            formData.append('ekgImage', input.files[0]);
            showToast('Subiendo imagenâ€¦', 'info');
            try {
                const res = await fetch('/api/upload', { method: 'POST', body: formData });
                if (res.ok) {
                    const data = await res.json();
                    cases[currentCaseIndex].etapas[stageIdx].ekg12d = data.filePath;
                    renderStages(cases[currentCaseIndex].etapas);
                    showToast('Imagen subida correctamente', 'success');
                } else {
                    showToast('Error al subir la imagen', 'error');
                }
            } catch (e) {
                showToast('Error de conexiÃ³n al subir', 'error');
            }
        }
    }

    // â”€â”€ Save â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function saveAll() {
        const btn = document.getElementById('save-btn');
        btn.disabled = true;
        btn.innerHTML = `
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation:spin 1s linear infinite"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
            Guardandoâ€¦`;

        const style = document.createElement('style');
        style.textContent = '@keyframes spin { to { transform: rotate(360deg); } }';
        document.head.appendChild(style);

        try {
            const res = await fetch('/api/casos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(cases)
            });
            if (res.ok) {
                showToast('Cambios guardados correctamente', 'success');
            } else {
                showToast('Error al guardar los cambios', 'error');
            }
        } catch (e) {
            showToast('Error de conexiÃ³n al guardar', 'error');
        } finally {
            btn.disabled = false;
            btn.innerHTML = `
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                Guardar Cambios`;
            style.remove();
        }
    }

    // Keyboard shortcut: Ctrl+S
    document.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            saveAll();
        }
    });

    // Close modal on overlay click
    document.getElementById('confirm-modal').addEventListener('click', function(e) {
        if (e.target === this) closeModal();
    });

    loadCases();
</script>

</body>
</html>